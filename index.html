<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Veloria Atelier</title>

<style>
body{margin:0;font-family:Arial;background:#f6f3f8;text-align:center}
header{background:#3b1c4a;color:#d4af37;padding:20px;font-size:26px}
.container{padding:15px}
.card{background:#fff;margin:15px auto;padding:15px;border-radius:14px;max-width:340px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
.card img{width:100%;border-radius:12px}
.price{color:#3b1c4a;font-weight:bold;margin:5px 0}
button{background:#3b1c4a;color:#fff;border:none;border-radius:8px;padding:8px 14px;margin:5px}
button.gold{background:#d4af37;color:#000}
.admin{display:none;background:#fff;margin:20px;padding:15px;border-radius:12px}
input{width:90%;padding:8px;margin:5px 0}
.qr{margin:20px}
footer{font-size:12px;color:#666;padding:15px}
</style>
</head>

<body>

<header id="adminTrigger">VELORIA ATELIER</header>

<div class="qr">
  <p>ğŸ“± Ø§Ù…Ø³Ø­ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ø­Ø¬Ø²</p>
  <img src="https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=https://abanobatia603-afk.github.io/veloria-system/" />
</div>

<div class="container" id="dresses"></div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
<div class="admin" id="admin">
  <h3>âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Veloria</h3>
  <input id="dressName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ³ØªØ§Ù†">
  <input id="dressPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
  <input type="file" id="dressImg" accept="image/*">
  <button class="gold" onclick="saveDress()">Ø­ÙØ¸</button>
</div>

<footer>
Veloria â€“ Luxury Dresses<br>
ğŸ“ 01228199366
</footer>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyDgPWCpM_Wp7Oz1ikCoR5nKe1VU47tTzV4",
  authDomain: "veloria-d5697.firebaseapp.com",
  projectId: "veloria-d5697",
  storageBucket: "veloria-d5697.firebasestorage.app",
  messagingSenderId: "445116618770",
  appId: "1:445116618770:web:bd94f78cb7575e28cb20cb"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

const PASSWORD = "veloria123";
let isAdmin = false;
let pressTimer;
let editId = null;

const box = document.getElementById("dresses");

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ³Ø§ØªÙŠÙ† */
async function loadDresses(){
  box.innerHTML="";
  const snap = await getDocs(collection(db,"dresses"));
  snap.forEach(docu=>{
    const d = docu.data();
    box.innerHTML+=`
      <div class="card">
        <img src="${d.img}">
        <h3>${d.name}</h3>
        <div class="price">${d.price} Ø¬Ù†ÙŠÙ‡</div>
        <a href="https://wa.me/201228199366?text=Ø¹Ø§ÙŠØ²Ù‡ Ø§Ø­Ø¬Ø² ${encodeURIComponent(d.name)}" target="_blank">
          <button>Ø§Ø­Ø¬Ø²ÙŠ ÙˆØ§ØªØ³Ø§Ø¨</button>
        </a>
        ${isAdmin ? `
          <br>
          <button onclick="editDress('${docu.id}','${d.name}','${d.price}','${d.img}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
          <button onclick="deleteDress('${docu.id}')">ğŸ—‘ Ø­Ø°Ù</button>
        ` : ``}
      </div>
    `;
  });
}
loadDresses();

/* Ø¶ØºØ·Ø© Ù…Ø·ÙˆÙ‘Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
const trigger = document.getElementById("adminTrigger");
["touchstart","mousedown"].forEach(e=>{
  trigger.addEventListener(e,()=>pressTimer=setTimeout(openAdmin,1200));
});
["touchend","mouseup","mouseleave"].forEach(e=>{
  trigger.addEventListener(e,()=>clearTimeout(pressTimer));
});

function openAdmin(){
  const pass = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:");
  if(pass === PASSWORD){
    isAdmin = true;
    admin.style.display="block";
    loadDresses();
  }else alert("ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­");
}

/* Ø­ÙØ¸ / ØªØ¹Ø¯ÙŠÙ„ */
window.saveDress = async ()=>{
  const name = dressName.value;
  const price = dressPrice.value;
  const file = dressImg.files[0];

  if(!name || !price || !file){
    alert("ÙƒÙ…Ù‘Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    return;
  }

  const imgRef = ref(storage, "dresses/"+Date.now());
  await uploadBytes(imgRef, file);
  const imgURL = await getDownloadURL(imgRef);

  if(editId){
    await updateDoc(doc(db,"dresses",editId),{name,price,img:imgURL});
    editId = null;
  }else{
    await addDoc(collection(db,"dresses"),{name,price,img:imgURL});
  }

  dressName.value=dressPrice.value="";
  dressImg.value="";
  loadDresses();
};

/* ØªØ¹Ø¯ÙŠÙ„ */
window.editDress = (id,name,price,img)=>{
  dressName.value=name;
  dressPrice.value=price;
  editId=id;
};

/* Ø­Ø°Ù */
window.deleteDress = async (id)=>{
  if(confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")){
    await deleteDoc(doc(db,"dresses",id));
    loadDresses();
  }
};
</script>

</body>
</html>
